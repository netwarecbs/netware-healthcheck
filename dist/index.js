(()=>{"use strict";var e={374:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getOptions=function(e){const t=Object.assign({},e);return i(t.log)||(t.log=Object.assign({},o.DEFAULT_OPTIONS.log,t.log)),Object.assign({},o.DEFAULT_OPTIONS,t)},t.isArray=function(e){return Array.isArray(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNullOrUndefined=i,t.isNullOrWhiteSpace=function(e){return!!i(e)||(n(e)?0===e.trim().length:0===e.toString().trim().length)},t.isNumber=function(e){return"number"==typeof e},t.isString=n;var o=r(623);function n(e){return"string"==typeof e}function i(e){return null==e}},623:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_OPTIONS=void 0,t.DEFAULT_OPTIONS={timeout:500,usage:!0,log:{logToConsole:!0,logToFile:!1,fileLocation:"./logs"}}},509:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UP=t.DOWN=void 0,t.UP="UP",t.DOWN="DOWN"},897:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UseProxy=t.UpgradeRequired=t.Unused=t.UnsupportedMediaType=t.Unauthorized=t.TemporaryRedirect=t.SwitchingProtocols=t.ServiceUnavailable=t.SeeOther=t.ResetContent=t.RequestedRangeNotSatisfiable=t.RequestUriTooLong=t.RequestTimeout=t.RequestEntityTooLarge=t.RedirectMethod=t.RedirectKeepVerb=t.Redirect=t.ProxyAuthenticationRequired=t.PreconditionFailed=t.PaymentRequired=t.PartialContent=t.OK=t.NotModified=t.NotImplemented=t.NotFound=t.NotAcceptable=t.NonAuthoritativeInformation=t.NoContent=t.MultipleChoices=t.MovedPermanently=t.Moved=t.MethodNotAllowed=t.LengthRequired=t.InternalServerError=t.HttpVersionNotSupported=t.Gone=t.GatewayTimeout=t.Found=t.Forbidden=t.ExpectationFailed=t.Created=t.Continue=t.Conflict=t.BadRequest=t.BadGateway=t.Ambiguous=t.Accepted=void 0,t.Accepted=202,t.Ambiguous=300,t.BadGateway=502,t.BadRequest=400,t.Conflict=409,t.Continue=100,t.Created=201,t.ExpectationFailed=417,t.Forbidden=403,t.Found=302,t.GatewayTimeout=504,t.Gone=410,t.HttpVersionNotSupported=505,t.InternalServerError=500,t.LengthRequired=411,t.MethodNotAllowed=405,t.Moved=301,t.MovedPermanently=301,t.MultipleChoices=300,t.NoContent=204,t.NonAuthoritativeInformation=203,t.NotAcceptable=406,t.NotFound=404,t.NotImplemented=501,t.NotModified=304,t.OK=200,t.PartialContent=206,t.PaymentRequired=402,t.PreconditionFailed=412,t.ProxyAuthenticationRequired=407,t.Redirect=302,t.RedirectKeepVerb=307,t.RedirectMethod=303,t.RequestedRangeNotSatisfiable=416,t.RequestEntityTooLarge=413,t.RequestTimeout=408,t.RequestUriTooLong=414,t.ResetContent=205,t.SeeOther=303,t.ServiceUnavailable=503,t.SwitchingProtocols=101,t.TemporaryRedirect=307,t.Unauthorized=401,t.UnsupportedMediaType=415,t.Unused=306,t.UpgradeRequired=426,t.UseProxy=305},863:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PUT=t.POST=t.PATCH=t.OPTIONS=t.HEAD=t.GET=t.DELETE=void 0,t.POST="POST",t.GET="GET",t.PUT="PUT",t.PATCH="PATCH",t.DELETE="DELETE",t.HEAD="HEAD",t.OPTIONS="OPTIONS"},65:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const{timeout:r}=e;return function(e,n,i){t?Promise.all(t.map((e=>Promise.race([e.check(),new Promise((e=>setTimeout(e,r,{alive:!1,healthy:!1,response:"Timeout"})))]).then((t=>({label:e.Label,response:t})))))).then((t=>{const r=t.every((({response:e})=>e.alive&&e.healthy));e._healthCheckResult={status:o.UP,healthy:r,results:t},i()})).catch((t=>{e._healthCheckResult={status:o.DOWN,healthy:!1,response:t.message},i()})):(e._healthCheckResult={status:o.UP},i())}};var o=r(509)},645:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{logToConsole:t,logToFile:r,fileLocation:a}=e.log,l=`${e.name}@${e.version}`,p=u({level:"info",json:!1});p.clear();const g=f((({level:e,message:t})=>{if(t.status===s.UP){const r=t.results&&t.results.length>0,o=(0,n.isNullOrUndefined)(t.healthy)?"no-data":t.healthy?"Ok":"Sick",i=r&&t.results.filter((({response:{alive:e,healthy:t}})=>e&&t)),s=r&&t.results.filter((({response:{alive:e}})=>!e)),a=r&&t.results.filter((({response:{alive:e,healthy:t}})=>e&&!t)),u=e=>e?e.length>0?e.map((({label:e})=>e)):"none":"no-data";return`${l}:${e}: Status: ${t.status}/${o}; Healthy: ${u(i)}; Dead: ${u(s)}; Sick: ${u(a)};`}return`${l}:${e}: Status: ${t.status}, Healthy: ${t.healthy}, Response: ${t.response}`}));return!0===t&&p.add(new d({format:c(h(),g)})),!0===r&&p.add(new o.default({filename:i.default.join(a,"./health-%DATE%.log"),datePattern:"YYYY-MM-DD",format:c(h(),g)})),p.stream={write(e){p.info(e.trim())}},function(e,t,r){p.info(e._healthCheckResult),r()}};var o=l(r(233)),n=r(23),i=l(r(928)),s=r(509),a=l(r(124));function l(e){return e&&e.__esModule?e:{default:e}}const{createLogger:u,transports:{Console:d},format:{combine:c,timestamp:h,printf:f}}=a.default},569:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(t,r){const o=Object.assign(t._healthCheckResult,{name:e.name,version:e.version});!0===e.usage&&Object.assign(o,{uptime:process.uptime(),usage:{memory:process.memoryUsage(),cpu:process.cpuUsage()}}),t._healthCheckResult.results&&t._healthCheckResult.results.length>0&&Object.assign(o,{results:void 0,subSystems:t._healthCheckResult.results.reduce(((e,{label:t,response:r})=>Object.assign(e,{[t]:r})),{})}),r.json(o)}}},943:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return function(e,t,r){t.set({"Cache-Control":"no-cache, no-store, must-revalidate",Expires:"0",Pragma:"no-cache"}),r()}}},10:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(374);t.default=class{constructor(e,t,r){if((0,o.isNullOrWhiteSpace)(e)||(0,o.isNullOrWhiteSpace)(t)||!(0,o.isArray)(r))throw new TypeError("Invalid arguments!");this._id=e,this._name=t,this._tags=r}get Id(){return this._id}get Name(){return this._name}get Tags(){return this._tags}check(){throw new Error(`Health check routine not implemented for ${this.Name}.`)}}},620:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(r(10)),n=r(374),i=s(r(518));function s(e){return e&&e.__esModule?e:{default:e}}class a extends o.default{constructor(e,t){if((0,n.isNullOrWhiteSpace)(e))throw new TypeError("Label is required");if((0,n.isNullOrWhiteSpace)(t))throw new TypeError("Configuration is required");super("mongodb-health","MongoDB health provider",["database"]),this._label=e,this._config=t}get Label(){return this._label}get Config(){return this._config}check(){return new Promise((e=>{const t=new i.default.MongoClient(this.Config.uri,this.Config.options);t.connect((function(r,o){t.close(),e(r?{alive:!0,healthy:!1,response:r}:{alive:!0,healthy:!0})}))}))}}t.default=a},668:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(r(10)),n=r(374),i=s(r(180));function s(e){return e&&e.__esModule?e:{default:e}}class a extends o.default{constructor(e,t){if((0,n.isNullOrWhiteSpace)(e))throw new TypeError("Label is required");if((0,n.isNullOrWhiteSpace)(t))throw new TypeError("Configuration is required");super("redis health","Redis Cache health provider",["cache","paas"]),this._label=e,this._config=t}get Label(){return this._label}get Config(){return this._config}check(){return new Promise((e=>{(0,i.default)(this.Config).checkStatus((function(t){e(t?{alive:!0,healthy:!1,response:t}:{alive:!0,healthy:!0})}))}))}}t.default=a},882:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=l(r(938)),n=l(r(10)),i=r(863),s=r(374),a=r(897);function l(e){return e&&e.__esModule?e:{default:e}}class u extends n.default{constructor(e,t,r=i.GET){if((0,s.isNullOrWhiteSpace)(e))throw new TypeError("Label is required");if((0,s.isNullOrWhiteSpace)(t))throw new TypeError("URL is required");super("service-health","Service health provider",["service"]),this._label=e,this._url=t,this._method=r}get Label(){return this._label}get URL(){return this._url}get Method(){return this._method}check(){return new Promise((e=>{(0,o.default)({url:this.URL,method:this.Method}).then((({data:t,status:r})=>{r===a.OK&&"UP"===t.status.toUpperCase()?e({alive:!0,healthy:!0,response:t}):e({alive:!0,healthy:!1,response:t})})).catch((t=>{t.response?e({alive:!1,healthy:!1,response:`Bad response. Status: ${t.response.status}`}):t.request?e({alive:!1,healthy:!1,response:"No response."}):e({alive:!1,healthy:!1,response:t.message})}))}))}}t.default=u},938:e=>{e.exports=require("axios")},518:e=>{e.exports=require("mongodb")},180:e=>{e.exports=require("redis-status")},124:e=>{e.exports=require("winston")},233:e=>{e.exports=require("winston-daily-rotate-file")},928:e=>{e.exports=require("path")},23:e=>{e.exports=require("util")}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,r),i.exports}var o={};(()=>{var e=o;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"BaseHealthProvider",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"MongoDBNativeHealthProvider",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"RedisCacheHealthProvider",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(e,"ServiceHealthProvider",{enumerable:!0,get:function(){return u.default}}),e.default=function(e,r){if(r&&Array.isArray(r)&&!r.every((e=>e instanceof t.default)))throw new TypeError("Invalid provider");const o=(0,c.getOptions)(e);return[(0,a.default)(o),(0,n.default)(o,r),(0,i.default)(o),(0,s.default)(o)]};var t=h(r(10)),n=h(r(65)),i=h(r(645)),s=h(r(569)),a=h(r(943)),l=h(r(620)),u=h(r(882)),d=h(r(668)),c=r(374);function h(e){return e&&e.__esModule?e:{default:e}}})(),module.exports=o})();